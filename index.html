<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fight CCF - ç¼–ç¨‹æ ¼æ–—æ¸¸æˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.544.0/dist/umd/lucide.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: #0a0a0a;
            color: #fff;
            overflow: hidden;
        }

        .orbitron {
            font-family: 'Orbitron', sans-serif;
        }

        .bg-main {
            background: #000;
            position: relative;
            overflow: hidden;
        }

        #digitalRain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.3;
        }

        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .computer {
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .computer:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 20px 40px rgba(0, 255, 255, 0.3);
        }

        .computer.locked::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .computer.locked::before {
            content: 'ğŸ”’';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            z-index: 10;
        }

        .character {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .character:hover {
            transform: scale(1.1);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 255, 255, 0.4);
        }

        .key-display {
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            color: #00ff00;
            word-break: break-all;
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .glow-text {
            text-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff, 0 0 30px #00ffff;
        }

        .copy-btn {
            transition: all 0.2s ease;
        }

        .copy-btn:hover {
            color: #00ff00;
            transform: scale(1.1);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #22c55e;
            color: white;
            border-radius: 8px;
            z-index: 2000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }
    </style>
</head>
<body class="bg-main">
    <!-- è´¦å·æ¨¡æ€æ¡† -->
    <div id="accountModal" class="modal active">
        <div class="glass rounded-2xl p-8 max-w-md w-full mx-4">
            <h2 class="text-3xl font-bold mb-6 text-center glow-text orbitron">Fight CCF</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">ç”¨æˆ·å</label>
                    <input type="text" id="username" class="w-full px-4 py-2 rounded-lg bg-black/50 border border-cyan-500 focus:outline-none focus:ring-2 focus:ring-cyan-400 text-white">
                </div>
                <div id="keySection" class="hidden">
                    <label class="block text-sm font-medium mb-2">ç§˜é’¥</label>
                    <input type="text" id="key" class="w-full px-4 py-2 rounded-lg bg-black/50 border border-cyan-500 focus:outline-none focus:ring-2 focus:ring-cyan-400 text-white">
                </div>
                <div class="flex space-x-4 pt-4">
                    <button id="loginBtn" class="btn flex-1 bg-cyan-600 hover:bg-cyan-700 text-white py-2 rounded-lg font-medium">ç™»å½•</button>
                    <button id="createBtn" class="btn flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg font-medium">åˆ›å»ºè´¦å·</button>
                </div>
                <div class="text-center text-sm text-gray-400 mt-4">
                    <p>ç™»å½•å°†åŒæ­¥ä½ çš„æ¸¸æˆè¿›åº¦</p>
                </div>
            </div>
        </div>
    </div>

    <!-- è§’è‰²è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="characterModal" class="modal">
        <div class="glass rounded-2xl p-8 max-w-lg w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold orbitron" id="characterName">è§’è‰²è¯¦æƒ…</h3>
                <button id="closeCharacterModal" class="text-gray-400 hover:text-white">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div class="flex items-center space-x-6 mb-6">
                <img id="characterImage" src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/d60eb7e0ce9745baa66fc43f1214cd41~tplv-a9rns2rl98-image.image?rcl=20251213131030A8FD11621FC82FEA2AB2&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1768194655&x-signature=u1jjuKDmnEOGwUYo4cTGDlGkN9w%3D" alt="è§’è‰²" class="w-32 h-32 object-contain">
                <div>
                    <p class="text-gray-300 mb-2">è§£é”ç« èŠ‚: <span id="unlockChapter">CSP-J</span></p>
                    <p class="text-gray-300">æˆ˜æ–—åŠ›: <span id="power">1000</span></p>
                </div>
            </div>
            <div class="space-y-4">
                <div class="glass rounded-lg p-4">
                    <h4 class="font-semibold text-cyan-400 mb-2">æ™®æ”» (I)</h4>
                    <p class="text-sm text-gray-300" id="normalAttack">å¿«é€Ÿç¼–ç¨‹æ”»å‡»ï¼Œé€ æˆåŸºç¡€ä¼¤å®³</p>
                </div>
                <div class="glass rounded-lg p-4">
                    <h4 class="font-semibold text-cyan-400 mb-2">ä¸€æŠ€èƒ½ (J)</h4>
                    <p class="text-sm text-gray-300" id="skill1">å¾ªç¯è½°ç‚¸ï¼šé‡Šæ”¾å¤šä¸ªç¼–ç¨‹å¾ªç¯ï¼Œå¯¹æ•Œäººé€ æˆæŒç»­ä¼¤å®³</p>
                </div>
                <div class="glass rounded-lg p-4">
                    <h4 class="font-semibold text-cyan-400 mb-2">äºŒæŠ€èƒ½ (K)</h4>
                    <p class="text-sm text-gray-300" id="skill2">é€’å½’çªåˆºï¼šä½¿ç”¨é€’å½’ç®—æ³•å‘å‰çªåˆºï¼Œé€ æˆç©¿é€ä¼¤å®³</p>
                </div>
                <div class="glass rounded-lg p-4">
                    <h4 class="font-semibold text-cyan-400 mb-2">ä¸‰æŠ€èƒ½ (L)</h4>
                    <p class="text-sm text-gray-300" id="skill3">ç®—æ³•çˆ†å‘ï¼šè°ƒç”¨é«˜çº§ç®—æ³•ï¼Œå¯¹æ•Œäººé€ æˆå¤§é‡ä¼¤å®³å¹¶é™„åŠ debuff</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸»æ¸¸æˆç•Œé¢ -->
    <div id="gameContainer" class="hidden h-screen flex flex-col">
        <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
        <div class="glass p-4 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <span class="orbitron text-lg" id="playerName">Player</span>
                <div class="relative">
                    <span class="key-display" id="userKey">å¯†é’¥å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</span>
                    <button id="copyKeyBtn" class="copy-btn absolute right-2 top-1/2 transform -translate-y-1/2">
                        <i data-lucide="copy" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>
            <div class="flex items-center space-x-6">
                <div class="text-right">
                    <p class="text-sm text-gray-400">å·²è§£é”ç« èŠ‚</p>
                    <p class="orbitron font-bold" id="unlockedChapters">1/6</p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-400">å·²è§£é”è§’è‰²</p>
                    <p class="orbitron font-bold" id="unlockedCharacters">1/6</p>
                </div>
            </div>
        </div>

        <!-- ä¸»è¦å†…å®¹åŒº -->
        <div class="flex-1 flex p-8 gap-8">
            <!-- å·¦ä¾§è§’è‰²é€‰æ‹© -->
            <div class="glass rounded-2xl p-6 w-64">
                <h3 class="text-xl font-bold mb-4 orbitron">è§’è‰²</h3>
                <div class="space-y-4" id="charactersList">
                    <div class="character glass rounded-lg p-4 flex items-center space-x-3 cursor-pointer" data-character="cspj">
                        <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/d60eb7e0ce9745baa66fc43f1214cd41~tplv-a9rns2rl98-image.image?rcl=20251213131030A8FD11621FC82FEA2AB2&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1768194655&x-signature=u1jjuKDmnEOGwUYo4cTGDlGkN9w%3D" alt="CSP-Jè§’è‰²" class="w-12 h-12 object-contain">
                        <div>
                            <p class="font-medium">CSP-Jé€‰æ‰‹</p>
                            <p class="text-xs text-gray-400">å·²è§£é”</p>
                        </div>
                    </div>
                    <!-- å…¶ä»–è§’è‰²å°†åœ¨è§£é”åæ˜¾ç¤º -->
                </div>
            </div>

            <!-- ä¸­å¤®ç« èŠ‚é€‰æ‹© -->
            <div class="flex-1 flex items-center justify-center">
                <div class="grid grid-cols-3 gap-8">
                    <div class="computer glass rounded-2xl p-6 text-center" data-chapter="cspj">
                        <div class="floating mb-4">
                            <i data-lucide="laptop" class="w-16 h-16 mx-auto text-cyan-400"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2 orbitron">CSP-J</h3>
                        <p class="text-sm text-gray-400">å…¥é—¨çº§ç¼–ç¨‹æŒ‘æˆ˜</p>
                        <div class="mt-4 text-xs text-cyan-400">
                            <p>å…³å¡: 4/4</p>
                        </div>
                    </div>
                    <div class="computer glass rounded-2xl p-6 text-center locked" data-chapter="csps">
                        <div class="floating mb-4">
                            <i data-lucide="laptop" class="w-16 h-16 mx-auto text-cyan-400"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2 orbitron">CSP-S</h3>
                        <p class="text-sm text-gray-400">æé«˜çº§ç¼–ç¨‹æŒ‘æˆ˜</p>
                    </div>
                    <div class="computer glass rounded-2xl p-6 text-center locked" data-chapter="noip">
                        <div class="floating mb-4">
                            <i data-lucide="laptop" class="w-16 h-16 mx-auto text-cyan-400"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2 orbitron">NOIP</h3>
                        <p class="text-sm text-gray-400">å…¨å›½é’å°‘å¹´ä¿¡æ¯å­¦å¥¥æ—åŒ¹å…‹è”èµ›</p>
                    </div>
                    <div class="computer glass rounded-2xl p-6 text-center locked" data-chapter="province">
                        <div class="floating mb-4">
                            <i data-lucide="laptop" class="w-16 h-16 mx-auto text-cyan-400"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2 orbitron">çœé€‰</h3>
                        <p class="text-sm text-gray-400">çœçº§é€‰æ‹”è€ƒè¯•</p>
                    </div>
                    <div class="computer glass rounded-2xl p-6 text-center locked" data-chapter="noi">
                        <div class="floating mb-4">
                            <i data-lucide="laptop" class="w-16 h-16 mx-auto text-cyan-400"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2 orbitron">NOI</h3>
                        <p class="text-sm text-gray-400">å…¨å›½é’å°‘å¹´ä¿¡æ¯å­¦å¥¥æ—åŒ¹å…‹ç«èµ›</p>
                    </div>
                    <div class="computer glass rounded-2xl p-6 text-center locked" data-chapter="ccf">
                        <div class="floating mb-4">
                            <i data-lucide="laptop" class="w-16 h-16 mx-auto text-cyan-400"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2 orbitron">CCFä¸»å¸­</h3>
                        <p class="text-sm text-gray-400">æœ€ç»ˆæŒ‘æˆ˜</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨æŒ‰é”®è¯´æ˜ -->
        <div class="glass p-4 text-center">
            <p class="text-sm text-gray-400">æŒ‰é”®è¯´æ˜: Wä¸Š Sä¸‹ Aå·¦ Då³ Iæ™®æ”» Jä¸€æŠ€èƒ½ KäºŒæŠ€èƒ½ Lä¸‰æŠ€èƒ½</p>
        </div>
    </div>

    <!-- é€šçŸ¥ -->
    <div id="notification" class="notification"></div>

    <!-- æ•°å­—é›¨èƒŒæ™¯ -->
    <canvas id="digitalRain"></canvas>

    <script>
        // åˆå§‹åŒ–Lucideå›¾æ ‡
        lucide.createIcons();

        // æ¸¸æˆæ•°æ®
        let gameData = {
            username: '',
            key: '',
            unlockedChapters: ['cspj'],
            unlockedCharacters: ['cspj'],
            currentCharacter: 'cspj',
            chapterProgress: {
                cspj: { completedLevels: 4, totalLevels: 4 },
                csps: { completedLevels: 0, totalLevels: 4 },
                noip: { completedLevels: 0, totalLevels: 3 },
                province: { completedLevels: 0, totalLevels: 4 },
                noi: { completedLevels: 0, totalLevels: 3 },
                ccf: { completedLevels: 0, totalLevels: 1 }
            }
        };

        // è§’è‰²æ•°æ®
        const characterData = {
            cspj: {
                name: 'CSP-Jé€‰æ‰‹',
                image: 'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/d60eb7e0ce9745baa66fc43f1214cd41~tplv-a9rns2rl98-image.image?rcl=20251213131030A8FD11621FC82FEA2AB2&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1768194655&x-signature=u1jjuKDmnEOGwUYo4cTGDlGkN9w%3D',
                unlockChapter: 'CSP-J',
                power: 1000,
                normalAttack: 'å¿«é€Ÿç¼–ç¨‹æ”»å‡»ï¼Œé€ æˆåŸºç¡€ä¼¤å®³',
                skill1: 'å¾ªç¯è½°ç‚¸ï¼šé‡Šæ”¾å¤šä¸ªç¼–ç¨‹å¾ªç¯ï¼Œå¯¹æ•Œäººé€ æˆæŒç»­ä¼¤å®³',
                skill2: 'é€’å½’çªåˆºï¼šä½¿ç”¨é€’å½’ç®—æ³•å‘å‰çªåˆºï¼Œé€ æˆç©¿é€ä¼¤å®³',
                skill3: 'ç®—æ³•çˆ†å‘ï¼šè°ƒç”¨é«˜çº§ç®—æ³•ï¼Œå¯¹æ•Œäººé€ æˆå¤§é‡ä¼¤å®³å¹¶é™„åŠ debuff'
            }
        };

        // ç”Ÿæˆç§˜é’¥
        function generateKey(data) {
            const str = JSON.stringify(data);
            return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, (match, p1) => 
                String.fromCharCode(parseInt(p1, 16))
            ));
        }

        // è§£æç§˜é’¥
        function parseKey(key) {
            try {
                const str = decodeURIComponent(Array.prototype.map.call(atob(key), (c) => 
                    '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)
                ).join(''));
                return JSON.parse(str);
            } catch (e) {
                return null;
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(text) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                }).catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    // é™çº§æ–¹æ¡ˆ
                    fallbackCopyTextToClipboard(text);
                });
            } else {
                // é™çº§æ–¹æ¡ˆ
                fallbackCopyTextToClipboard(text);
            }
        }

        // é™çº§å¤åˆ¶æ–¹æ¡ˆ
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showNotification('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                } else {
                    showNotification('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                }
            } catch (err) {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                showNotification('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            }
            document.body.removeChild(textArea);
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            document.getElementById('playerName').textContent = gameData.username;
            document.getElementById('userKey').textContent = gameData.key;
            document.getElementById('unlockedChapters').textContent = `${gameData.unlockedChapters.length}/6`;
            document.getElementById('unlockedCharacters').textContent = `${gameData.unlockedCharacters.length}/6`;
            
            // æ›´æ–°è§’è‰²åˆ—è¡¨
            updateCharactersList();
            
            // æ˜¾ç¤ºæ¸¸æˆå®¹å™¨
            document.getElementById('accountModal').classList.remove('active');
            document.getElementById('gameContainer').classList.remove('hidden');
            
            // é‡æ–°ç»‘å®šå¤åˆ¶æŒ‰é’®äº‹ä»¶ï¼ˆç¡®ä¿åœ¨DOMæ›´æ–°åç»‘å®šï¼‰
            setTimeout(() => {
                const copyBtn = document.getElementById('copyKeyBtn');
                if (copyBtn) {
                    copyBtn.addEventListener('click', function() {
                        const keyText = document.getElementById('userKey').textContent;
                        if (keyText && keyText !== 'å¯†é’¥å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ') {
                            copyToClipboard(keyText);
                        } else {
                            showNotification('æš‚æ— å¯ç”¨çš„ç§˜é’¥');
                        }
                    });
                }
            }, 100);
        }

        // æ›´æ–°è§’è‰²åˆ—è¡¨
        function updateCharactersList() {
            const list = document.getElementById('charactersList');
            list.innerHTML = '';
            
            gameData.unlockedCharacters.forEach(charId => {
                const char = characterData[charId];
                const div = document.createElement('div');
                div.className = 'character glass rounded-lg p-4 flex items-center space-x-3 cursor-pointer';
                div.dataset.character = charId;
                div.innerHTML = `
                    <img src="${char.image}" alt="${char.name}" class="w-12 h-12 object-contain">
                    <div>
                        <p class="font-medium">${char.name}</p>
                        <p class="text-xs text-gray-400">å·²è§£é”</p>
                    </div>
                `;
                div.addEventListener('click', () => showCharacterDetails(charId));
                list.appendChild(div);
            });
        }

        // æ˜¾ç¤ºè§’è‰²è¯¦æƒ…
        function showCharacterDetails(charId) {
            const char = characterData[charId];
            document.getElementById('characterName').textContent = char.name;
            document.getElementById('characterImage').src = char.image;
            document.getElementById('unlockChapter').textContent = char.unlockChapter;
            document.getElementById('power').textContent = char.power;
            document.getElementById('normalAttack').textContent = char.normalAttack;
            document.getElementById('skill1').textContent = char.skill1;
            document.getElementById('skill2').textContent = char.skill2;
            document.getElementById('skill3').textContent = char.skill3;
            
            document.getElementById('characterModal').classList.add('active');
        }

        // è¿›å…¥ç« èŠ‚
        function enterChapter(chapter) {
            if (!gameData.unlockedChapters.includes(chapter)) {
                showNotification('è¯¥ç« èŠ‚å°šæœªè§£é”');
                return;
            }

            // æ£€æŸ¥æ˜¯å¦æœ‰å¯¹åº”çš„HTMLæ–‡ä»¶
            const chapterMap = {
                cspj: 'cspj.html',
                csps: 'csps.html',
                noip: 'noip.html',
                province: 'province.html',
                noi: 'noi.html',
                ccf: 'ccf.html'
            };

            if (chapter === 'cspj') {
                // å¯¹äºCSP-Jï¼Œç›´æ¥è·³è½¬
                window.location.href = chapterMap[chapter];
            } else {
                // å¯¹äºå…¶ä»–ç« èŠ‚ï¼Œæ˜¾ç¤ºæœªå¼€å‘æç¤º
                showNotification('è¯¥ç« èŠ‚å°šæœªå¼€å‘');
                setTimeout(() => {
                    // å¯ä»¥æ·»åŠ è¿”å›æ•ˆæœ
                }, 1500);
            }
        }

        // æ•°å­—é›¨æ•ˆæœ
        function initDigitalRain() {
            const canvas = document.getElementById('digitalRain');
            const ctx = canvas.getContext('2d');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const characters = '01';
            const fontSize = 14;
            const columns = canvas.width / fontSize;
            
            const drops = [];
            for (let i = 0; i < columns; i++) {
                drops[i] = Math.random() * -100;
            }
            
            function draw() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#00ff00';
                ctx.font = fontSize + 'px monospace';
                
                for (let i = 0; i < drops.length; i++) {
                    const text = characters.charAt(Math.floor(Math.random() * characters.length));
                    ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                    
                    if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                        drops[i] = 0;
                    }
                    drops[i]++;
                }
            }
            
            setInterval(draw, 33);
            
            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
        }

        // äº‹ä»¶ç›‘å¬å™¨
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–æ•°å­—é›¨
            initDigitalRain();
            
            // ç¡®ä¿å¤åˆ¶æŒ‰é’®äº‹ä»¶æ­£ç¡®ç»‘å®š
            const bindCopyButton = () => {
                const copyBtn = document.getElementById('copyKeyBtn');
                if (copyBtn) {
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                    copyBtn.replaceWith(copyBtn.cloneNode(true));
                    // é‡æ–°ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
                    const newCopyBtn = document.getElementById('copyKeyBtn');
                    newCopyBtn.addEventListener('click', function() {
                        const keyText = document.getElementById('userKey').textContent;
                        if (keyText && keyText !== 'å¯†é’¥å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ') {
                            copyToClipboard(keyText);
                        } else {
                            showNotification('æš‚æ— å¯ç”¨çš„ç§˜é’¥');
                        }
                    });
                }
            };
            
            // ç«‹å³ç»‘å®šå¤åˆ¶æŒ‰é’®
            bindCopyButton();
            // ç™»å½•æŒ‰é’®
            document.getElementById('loginBtn').addEventListener('click', function() {
                const keySection = document.getElementById('keySection');
                const keyInput = document.getElementById('key');
                
                if (keySection.classList.contains('hidden')) {
                    keySection.classList.remove('hidden');
                    this.textContent = 'ç¡®è®¤ç™»å½•';
                } else {
                    const key = keyInput.value.trim();
                    if (key) {
                        const parsedData = parseKey(key);
                        if (parsedData) {
                            gameData = { ...gameData, ...parsedData };
                            gameData.key = key;
                            initGame();
                        } else {
                            showNotification('æ— æ•ˆçš„ç§˜é’¥');
                        }
                    } else {
                        showNotification('è¯·è¾“å…¥ç§˜é’¥');
                    }
                }
            });

            // åˆ›å»ºè´¦å·æŒ‰é’®
            document.getElementById('createBtn').addEventListener('click', function() {
                const username = document.getElementById('username').value.trim();
                if (username) {
                    gameData.username = username;
                    gameData.key = generateKey(gameData);
                    initGame();
                } else {
                    showNotification('è¯·è¾“å…¥ç”¨æˆ·å');
                }
            });

            // å¤åˆ¶ç§˜é’¥æŒ‰é’®
            document.getElementById('copyKeyBtn').addEventListener('click', function() {
                copyToClipboard(gameData.key);
            });

            // å…³é—­è§’è‰²è¯¦æƒ…æ¨¡æ€æ¡†
            document.getElementById('closeCharacterModal').addEventListener('click', function() {
                document.getElementById('characterModal').classList.remove('active');
            });

            // ç« èŠ‚ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.computer').forEach(computer => {
                computer.addEventListener('click', function() {
                    const chapter = this.dataset.chapter;
                    enterChapter(chapter);
                });
            });

            // ç¦ç”¨å³é”®å’ŒCtrlé”®
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                return false;
            });

            document.addEventListener('keydown', function(e) {
                // ç¦ç”¨Ctrl+U, Ctrl+C, Ctrl+X, Ctrl+Sç­‰
                if (e.ctrlKey && ['u', 'c', 'x', 's', 'a', 'z'].includes(e.key.toLowerCase())) {
                    e.preventDefault();
                    return false;
                }
                // ç¦ç”¨F12
                if (e.key === 'F12') {
                    e.preventDefault();
                    return false;
                }
            });
        });

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });
    </script>
</body>
</html>
